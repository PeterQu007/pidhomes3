!function(t){var e={};function a(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=2)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function a(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}},function(t,e,a){"use strict";a.r(e);var r=a(0),n=a.n(r),i=a(1),c=a.n(i),o=function(){function t(e,a){n()(this,t),this.btnDraw=document.getElementById("create_".concat(e)),this.drawingContainer=document.getElementById("canvas_drawing_".concat(e)),this.marketSection=a,this.chartType="",this.updateChartCommunities(),this.chartCanvasID=e,this.drawCanvas=document.getElementById(this.chartCanvasID),this.propertyTypeSelect=document["pidMarketForm_".concat(e)]["Property_Type_".concat(e)],this.chartTypeSelect=document["pidMarketForm_ChartType_".concat(e)]["Chart_Type_".concat(e)],this.monthSelect=document["pidMarketForm_Time_".concat(e)]["Stats_month_".concat(e)],this.YearSelect=document["pidMarketForm_Time_".concat(e)]["Stats_Year_".concat(e)];$j("#share-button-title").text();var r=$j(".only-for-print img").attr("src");this.socialDefaultConfig={title:"Market Report 2020",image:r,description:"Great Vancouver Real Estate Chart",ui:{flyout:($j("body").hasClass("rtl"),"bottom center")},networks:{email:{title:"Market Report 2020",description:"Great Vancouver Real Estate Chart%0A%0AHPI Chart URL: "+window.location.href}},postID:null},this.RegisterSocialButtons.call(this,jQuery)}return c()(t,[{key:"RegisterSocialButtons",value:function(t){var e=this;this.socialShare=new Share(".share-this-chart",this.socialDefaultConfig),this.socialDefaultConfig=JSON.parse(JSON.stringify(this.socialShare.config)),this.share_button=t(t(".share-this-chart")[0]),this.share_icon=t("#social-share-chart"),this.share_icon.on("click",(function(t){t.preventDefault(),e.socialShare.config.url.indexOf("/ss")>=0?e.socialShare.toggle():e.postCanvasToURL((function(t){var a=e.socialShare.config;a.url=pid_Data.siteurl+"/ss".concat(t,"/"),a.networks.twitter.url=a.url,a.networks.facebook.url=a.url;var r="en"==pid_Data.language?" Real Estate Home Price Chart":"房地产价格走势图";a.description=e.chartCommunities.join(" | ")+r,a.networks.twitter.description=a.description,e.socialShare.config=a,e.socialShare.toggle()}))})),this.share_button.on("click",(function(t){t.preventDefault(),e.socialShare.config.url.indexOf("/ss")>=0||e.postCanvasToURL((function(t){var a=e.socialShare.config;a.url=pid_Data.siteurl+"/ss".concat(t,"/"),a.networks.twitter.url=a.url,a.networks.facebook.url=a.url;var r="en"==pid_Data.language?" Real Estate Home Price Chart":"房地产价格走势图";a.description=e.chartCommunities.join(" | ")+r,a.networks.twitter.description=a.description,e.socialShare.config=a}))}))}},{key:"postCanvasToURL",value:function(t){this.drawCanvas=document.getElementById(this.chartCanvasID);var e=this.drawCanvas.toDataURL();console.log("Blob");var a=document.createElement("img");a.src=e,a.classList.add("inspiry-qr-code");var r=this.drawingContainer.querySelector("img");r&&r.remove(),this.drawingContainer.append(a),this.uploadImage(e,t)}},{key:"postDivToCanvasURL",value:function(t){var e=this;html2canvas(document.querySelector("#capture"),{allowTaint:!0}).then((function(a){e.drawCanvas=a;var r=e.drawCanvas.toDataURL(),n=document.createElement("img");n.src=r,n.classList.add("inspiry-qr-code");var i=e.drawingContainer.querySelector("img");i&&i.remove(),e.drawingContainer.append(n),e.drawingContainer.append(a),e.uploadImage(r,t)}))}},{key:"updateChartCommunities",value:function(){var t=this.marketSection,e=null,a={};if(t.indexOf("_sub_markets_")<0){e=$j(t);var r=$j('label[for="'+e.attr("id")+'"]')[0];a.nbhCode=r.innerText}else{e=$j(t).find('input[type="hidden"]');for(var n=$j(t).find("label"),i="",c=0;c<e.length;c++){if("yes"==$j(n[c]).attr("showchart")){var o=$j(e[c]).attr("nbhcodes"),s=JSON.parse($j(e[c]).attr("nbhnames"));i=i+" "+o,a[o]=s[o]}}i=i.trim().split(" ").join(", ")}this.chartCommunities=Object.values(a),this.chartType=e.attr("name")}},{key:"uploadImage",value:function(t,e){var a=pid_Data.siteurl+"/wp-admin/admin-ajax.php",r=this.dataURItoBlob(t),n=new File([r],"uploadImage.png");this.updateChartCommunities();for(var i=this.propertyTypeSelect,c="",o=0;o<i.length;o++){var s=i[o];if("radio"==s.type&&s.checked){c=s.value;break}"checkbox"==s.type&&(c=s.checked?s.labels[0].innerText:"")}var l="",h=this.chartTypeSelect;for(o=0;o<h.length;o++){var u=h[o];"radio"==u.type&&u.checked&&(l=u.value)}var d=new FormData;d.append("fileToUpload",n),d.append("action","uploadimage"),d.append("chartParams",JSON.stringify({PropertyType:c,Years:"2020",ChartType:l,Communities:JSON.stringify(this.chartCommunities)})),$j.ajax({url:a,dataType:"text",cache:!1,contentType:!1,processData:!1,data:d,type:"post",success:function(t){t=t.split(",")[0],e(t)}})}},{key:"blobToFile",value:function(t,e){return t.lastModifiedDate=new Date,t.name=e,t}},{key:"dataURItoBlob",value:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var a=t.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return new Blob([r],{type:a})}}]),t}(),s=function(){function t(e,a){n()(this,t),a=(a=a.split(" ").join("_")).replace("(","").replace(")","");var r="\n          <div id='pid_sub_market_".concat(e,"_").concat(a,"' class='pid_sub_market_hidden'>\n            <input class=\"pid_sub_market_close\" id=\"pid_sub_market_close_").concat(e,"_").concat(a,"\" type='button' value='X'>\n          </div>\n    "),i=$j(r);this.formContainer=$j("#pid_sub_markets_fieldset_"+e),this.formContainer.append(i),this.btnClose=$j("#pid_sub_market_close_".concat(e,"_").concat(a)),this.containerID="#pid_sub_market_".concat(e,"_").concat(a),this.labelContainer=$j(this.containerID),this.removeClass(),this.events()}return c()(t,[{key:"events",value:function(){var t=this;this.btnClose.on("click",(function(){console.log("clicked");var e=t.containerID;$j("".concat(e," label")).remove(),$j("".concat(e," input[name='nbh_sub_market']")).remove(),t.labelContainer.remove()}))}},{key:"removeClass",value:function(){this.labelContainer.removeClass("pid_sub_market_hidden")}}]),t}(),l=function(){function t(e){var a=this;n()(this,t),this.vw=document.getElementsByClassName("rh_page__main")[0].getBoundingClientRect().width,this.vh=document.getElementsByClassName("rh_page__main")[0].getBoundingClientRect().height,this.activeClass="metabox__blog-home-link-active",this.nonActiveClass="metabox__blog-home-link",this.chartCanvasID=e,this.chartCommunities=[],this.chartType="",this.Years=[2019,2020],this.Month=1,this.nbhLabel="",this.canvasImage=null,this.htmlShareLink=$j("#pid_chart_share_link"),this.htmlShareInput=$j("#pid_chart_share_input"),this.chartColors2=["rgba(178, 32, 37, 0.95)","rgba(255, 205, 86, 0.95)","rgba(75, 192, 192, 0.95)","rgba(255, 159, 64, 0.95)","rgba(54, 162, 235, 0.95)","rgba(153, 102, 255, 0.95)","rgba(204,0,102, 0.95)","rgba(128,128,128, 0.95)","rgba(128,0,0, 0.95)","rgba(85,107,47, 0.95)","rgba(178, 32, 37, 0.75)","rgba(255, 159, 64, 0.75)","rgba(255, 205, 86, 0.75)","rgba(75, 192, 192, 0.75)","rgba(54, 162, 235, 0.75)","rgba(153, 102, 255, 0.75)","rgba(204,0,102, 0.75)","rgba(128,128,128, 0.75)","rgba(128,0,0, 0.75)","rgba(85,107,47, 0.75)","rgba(178, 32, 37, 0.5)","rgba(255, 159, 64, 0.5)","rgba(255, 205, 86, 0.5)","rgba(75, 192, 192, 0.5)","rgba(54, 162, 235, 0.5)","rgba(153, 102, 255, 0.5)","rgba(204,0,102, 0.5)","rgba(128,128,128, 0.5)","rgba(128,0,0, 0.5)","rgba(85,107,47, 0.5)","rgba(178, 32, 37, 0.25)","rgba(255, 159, 64, 0.25)","rgba(255, 205, 86, 0.25)","rgba(75, 192, 192, 0.25)","rgba(54, 162, 235, 0.25)","rgba(153, 102, 255, 0.25)","rgba(204,0,102, 0.25)","rgba(128,128,128, 0.25)","rgba(128,0,0, 0.25)","rgba(85,107,47, 0.25)","rgba(178, 32, 37, 0.15)","rgba(255, 159, 64, 0.15)","rgba(255, 205, 86, 0.15)","rgba(75, 192, 192, 0.15)","rgba(54, 162, 235, 0.15)","rgba(153, 102, 255, 0.15)","rgba(204,0,102, 0.15)","rgba(128,128,128, 0.15)","rgba(128,0,0, 0.15)","rgba(85,107,47, 0.15)"];var r;this.PropertyTypeSelect=document["pidMarketForm_".concat(e)]["Property_Type_".concat(e)],this.YearSelect=document["pidMarketForm_Time_".concat(e)]["Stats_Year_".concat(e)],this.Years=[],Array.from(this.YearSelect).forEach((function(t){t.checked&&a.Years.push(t.value)})),this.MonthSelect=document["pidMarketForm_Time_".concat(e)]["Stats_month_".concat(e)],this.Month=parseInt(this.MonthSelect.value),this.ChartTypeSelect=document["pidMarketForm_ChartType_".concat(e)]["Chart_Type_".concat(e)],this.LocationForm=document["pidMarketForm_location_".concat(e)],this.Locations=this.LocationForm["nbh_group_location_".concat(e)];var i=this.LocationForm.getElementsByTagName("label"),c=Array.from(i).filter((function(t,e){return $j(t).hasClass(a.activeClass)})),o=0;1==c.length&&(o=Array.from(i).indexOf(c[0])),r="#"+$j(this.Locations[o]).attr("id"),this.marketSection=r,$j(i[o]).addClass(this.activeClass),this.neighborhoodCodes=$j(r).attr("nbhcodes"),this.neighborhoodNames=JSON.parse($j(r).attr("nbhnames")),this.prepareCanvas(this.neighborhoodNames.length),this.configChart([],this.chartColors2),this.getChartData(r),this.events()}return c()(t,[{key:"events",value:function(){var t=this;document.getElementById("form_footer_button_".concat(this.chartCanvasID)).addEventListener("click",(function(){console.log("start over clicked");var e=$j("#pid_sub_markets_fieldset_"+t.chartCanvasID);document.getElementById("filter_subMarket_".concat(t.chartCanvasID)).value="",e.find("label").attr("showchart","no").removeClass("pid_sub_select pid_sub_market_filtered"),$j(t.Locations[0]).click(),$j(t.LocationForm.getElementsByTagName("label")).removeClass(t.activeClass),$j(t.LocationForm.getElementsByTagName("label")[0]).addClass(t.activeClass)})),document.getElementById("filter_subMarket_".concat(this.chartCanvasID)).addEventListener("keyup",(function(e){console.log("filter pressed");var a=e.target.value,r=$j("#pid_sub_markets_fieldset_"+t.chartCanvasID);r.find("label").removeClass("pid_sub_market_filtered"),""!==a&&r.find("label").filter((function(t,e){return $j(e).text().toLowerCase().indexOf(a.toLowerCase())>=0})).addClass("pid_sub_market_filtered")}));for(var e=this.PropertyTypeSelect,a=0;a<e.length;a++)e[a].addEventListener("change",(function(a){"radio"==a.target.type&&(e[e.length-1].checked=!1);var r=a.target.value;t.htmlShareInput.val(t.buildShareLink("dwell",r)),t.updateChart(a)}));var r=this.YearSelect;for(a=0;a<r.length;a++)r[a].addEventListener("click",(function(e){console.log("checkbox clicked!"),t.Years=[];for(var a=t.YearSelect,r="",n=0;n<a.length;n++)a[n].checked&&(t.Years.push(parseInt(a[n].value)),r+=a[n].value+",");r=r.slice(0,-1),t.htmlShareInput.val(t.buildShareLink("year",r));var i=t.activeClass,c=t.LocationForm.getElementsByTagName("label");for(n=0;n<c.length;n++)if(c[n].className.indexOf(i)>=0){var o=$j(c[n]).attr("for");$j("#"+o).trigger("click")}}));this.MonthSelect.addEventListener("change",(function(e){console.log("month changed!"),t.Month=e.target.value,t.htmlShareInput.val(t.buildShareLink("month",t.Month));for(var a=t.activeClass,r=t.LocationForm.getElementsByTagName("label"),n=0;n<r.length;n++)if(r[n].className.indexOf(a)>=0){var i=$j(r[n]).attr("for");$j("#"+i).trigger("click")}}));var n=this.ChartTypeSelect;for(a=0;a<n.length;a++)n[a].addEventListener("change",(function(e){console.log("Chart Type Changed"),t.Years=[];for(var a=t.YearSelect,r="",n=0;n<a.length;n++)a[n].checked&&(t.Years.push(parseInt(a[n].value)),r+=a[n].value+",");r=r.slice(0,-1),t.htmlShareInput.val(t.buildShareLink("year",r)),t.htmlShareInput.val(t.buildShareLink("chart","percentage"==e.target.value?"perc":"dollar"));var i=t.activeClass,c=t.LocationForm.getElementsByTagName("label");for(n=0;n<c.length;n++)if(c[n].className.indexOf(i)>=0){var o=$j(c[n]).attr("for");return void $j("#"+o).trigger("click")}t.prepareCanvas(),t.configChart([],t.chartColors2),t.getChartData_Compare("#pid_sub_markets_fieldset_"+t.chartCanvasID)}));var i=this.LocationForm.getElementsByTagName("label");for(a=0;a<i.length;a++)i[a].addEventListener("click",(function(e){console.log("label clicked:",e.target),t.nbhLabel=e.target.innerText,t.nbhLabel=e.target.getAttribute("slug");for(var a=e.target.parentElement.querySelectorAll("label"),r=t.nonActiveClass,n=0;n<a.length;n++)a[n].classList.add(r);var i=t.activeClass;a.forEach((function(t,a){t.innerText!=e.target.innerText&&t.classList.remove(i)})),$j(e.target).toggleClass(i);var c=$j(e.target).attr("for");if(0==$j("#pid_sub_markets_fieldset_"+t.chartCanvasID).find("label.pid_sub_market_label_heading").filter((function(t,a){return $j(a).text()===e.target.innerText})).length){$j("#"+c).trigger("click");var o=new s(t.chartCanvasID,e.target.getAttribute("slug"))}else{if($j(e.target).hasClass(i))return void $j("#"+c).trigger("click");t.prepareCanvas(),t.configChart([],t.chartColors2),t.getChartData_Compare("#pid_sub_markets_fieldset_"+t.chartCanvasID)}for(var l=$j("#"+c).attr("nbhcodes").split(","),h=JSON.parse($j("#"+c).attr("nbhnames")),u=0;u<l.length;u++){var d=h[l[u]],p=c+"_"+l[u],m="pid_sub_market_label";0==u&&t.chartCanvasID.indexOf("_1")<0&&(m="pid_sub_market_label_heading");var _={};_[l[u]]=h[l[u]];var g=JSON.stringify(_),v=$j('<label class="'.concat(m,'" slug="').concat(d,'" showchart="no" for="').concat(p,'">').concat(d,"</label>"));if(!($j("#".concat(p)).length>0)){var f=$j('<input type="hidden" id="'.concat(p,'" name="nbh_sub_market" nbhcodes="').concat(l[u],"\" nbhnames='").concat(g,"'>"));o.labelContainer.append(v),o.labelContainer.append(f),v.on("click",(function(e){var a=$j(e.target),r=a.attr("for");console.log("subMarket:: ",r),a.toggleClass("pid_sub_select");var n=t.LocationForm.getElementsByTagName("label");t.nbhLabel=e.target.innerText,t.nbhLabel=e.target.getAttribute("slug"),$j(n).removeClass(t.activeClass),a.hasClass("pid_sub_select")?a.attr("showchart","yes"):a.attr("showchart","no"),t.prepareCanvas(h.length),t.configChart([],t.chartColors2),t.getChartData_Compare("#pid_sub_markets_fieldset_"+t.chartCanvasID)}))}}}));var c=this.Locations;for(a=0;a<c.length;a++)c[a].addEventListener("click",(function(e){var a=$j(e.target);console.log("input clicked:",e.target);var r="#"+a.attr("id");t.neighborhoodCodes=$j(r).attr("nbhcodes"),console.log(t.neighborhoodCodes),t.neighborhoodNames=JSON.parse($j(r).attr("nbhnames")),console.log(t.neighborhoodNames),t.prepareCanvas(t.neighborhoodNames.length),t.configChart([],t.chartColors2),t.getChartData(r)}))}},{key:"prepareCanvas",value:function(){this.vw=document.getElementsByClassName("rh_page__main")[0].getBoundingClientRect().width,this.vh=document.getElementsByClassName("rh_page__main")[0].getBoundingClientRect().height,this.chartDataSets_All=[],this.chartDataSets_Detached=[],this.chartDataSets_Townhouse=[],this.chartDataSets_Apartment=[],this.chartDataSets_GroupByNbh=[],this.pidChart={},this.chartConfig={};var t=document.getElementById(this.chartCanvasID);this.chartCanvas=t;var e=t.getContext("2d"),a=t.width,r=t.height;e.clearRect(0,0,a,r);var n=$j("#canvas_wrapper_"+this.chartCanvasID);t.remove();var i='<canvas id="'+this.chartCanvasID+'" height="400px !important" , width="400"></canvas>';n.append(i);var c=document.querySelector("#"+this.chartCanvasID);c.hidden=!0;var o=c.getContext("2d");o.canvas.width=.9*this.vw;var s=o.canvas.width/16*9;switch(!0){case o.canvas.width<500:o.canvas.height=.8*o.canvas.width;break;case o.canvas.width<1100:o.canvas.height=.7*o.canvas.width;break;default:o.canvas.height=s}this.ctx=o}},{key:"prepareCanvasSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this.vw=document.getElementsByClassName("rh_page__main")[0].getBoundingClientRect().width,this.vh=document.getElementsByClassName("rh_page__main")[0].getBoundingClientRect().height;var e=document.querySelector("#"+this.chartCanvasID);e.hidden=!0;var a=e.getContext("2d");a.canvas.width=.9*this.vw;var r=a.canvas.width/16*9;switch(!0){case a.canvas.width<500:switch(!0){case t<4:a.canvas.height=r;break;case t>=4&&t<8:a.canvas.height=1.2*r;break;default:a.canvas.height=1.5*r}break;case a.canvas.width<1100:a.canvas.height=t>14?.9*a.canvas.width:r;break;default:a.canvas.height=.8*a.canvas.width}this.ctx=a,this.chartConfig.options.legend.maxSize.height=.2*a.canvas.height}},{key:"configChart",value:function(t,e){var a=this;if(0==t.length)for(var r=this.neighborhoodCodes.split(","),n=0;n<r.length;n++)t.push({label:"",data:{}});var i=[];for(n=0;n<t.length;n++)i.push({label:t[n].label,fill:!1,backgroundColor:e[n],borderColor:e[n],data:t[n].data});var c={type:"line",data:{datasets:i},options:{title:{display:!1,text:""},legend:{maxSize:{height:80},position:"bottom",labels:{fontFamily:"Helvetica"}},responsive:!0,maintainAspectRatio:!1,tooltips:{mode:"interpolate",intersect:!1},plugins:{crosshair:{line:{color:"#F66",width:1},sync:{enabled:!1,group:1,suppressTooltips:!1},zoom:{enabled:!1,zoomboxBackgroundColor:"rgba(66,133,244,0.2)",zoomboxBorderColor:"#48F",zoomButtonText:"Reset Zoom",zoomButtonClass:"reset-zoom"},callbacks:{beforeZoom:function(t,e){return!0},afterZoom:function(t,e){setTimeout((function(){chart6.data.datasets[0].data=generate(t,e),chart6.update()}),1e3)}}}},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{type:"time",time:{unit:"quarter",displayFormats:{quarter:"YY[Q]Q"}}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"dollar"==a.ChartTypeSelect.value?"House Value"+(a.vw<500?"(million dollars)":"(dollars)"):"Change %"},fontFamily:"monospaced",ticks:{callback:function(t,e,r){var n="";return"dollar"==a.ChartTypeSelect.value&&(n=a.vw<500?t/1e6:"$"+t/1e3+"K"),"percentage"==a.ChartTypeSelect.value&&(n=t+"%"),n}}}]}},defaults:{global:{defaultFontFamily:"Helvetica"}}};this.chartConfig={},this.chartConfig=c}},{key:"updateChart",value:function(t){var e=this;switch(console.log(t.target.value),console.log(this.pidChart),t.target.value.toLowerCase().trim()){case"all":case"detached":case"townhouse":case"apartment":case"condo":this.configChart(this["chartDataSets_".concat(t.target.value.trim())],this.chartColors2);break;default:if(t.target.checked){for(var a=this.PropertyTypeSelect,r=0;r<a.length-1;r++)a[r].checked=!1;var n=this.chartDataSets_GroupByNbh[0][0],i=this.chartDataSets_GroupByNbh.filter((function(t){return t[0]==n})).map((function(t){return t[1]}));this.configChart(i,this.chartColors2)}else Array.from(this.PropertyTypeSelect).filter((function(t){return t.checked})).map((function(t){e.configChart(e["chartDataSets_".concat(t.value)],e.chartColors2)}))}this.pidChart.config=this.chartConfig,this.pidChart.update(),$j("#".concat(this.chartCanvasID)).length>0&&(null==this.canvasImage?this.canvasImage=new o(this.chartCanvasID):this.canvasImage.socialShare.config=JSON.parse(JSON.stringify(this.canvasImage.socialDefaultConfig))),this.drawCanvas=document.getElementById(this.chartCanvasID)}},{key:"removeData",value:function(t){t.data.labels.pop(),t.data.datasets.forEach((function(t){t.data.pop()})),t.update()}},{key:"addData",value:function(t,e,a){t.data.labels.push(e),a.forEach((function(e){return t.data.datasets.push(e)})),t.update(),console.log(t.data.datasets)}},{key:"buildShareLink",value:function(t,e){e=e.toLowerCase();var a=this.htmlShareInput.val(),r=/https?:\/\/([a-z0-9A-Z\.-]+\/)+/,n=/dwell=[a-z]+/,i=/chart=[a-z]+/,c=/y=[\d,]+/,o=/mh=[\d]{1,2}/,s=r.test(a)?a.match(r)[0]:"",l=n.test(a)?a.match(n)[0]:"dwell=all",h=i.test(a)?"$"+a.match(i)[0]:"",u=c.test(a)?"$"+a.match(c)[0]:"",d=o.test()?"$"+a.match(o)[0]:"";switch(t){case"dwell":l="dwell=".concat(e="on"==e?"groupbynbh":e);break;case"chart":h="$chart=".concat(e);break;case"year":u="$y=".concat(e);break;case"month":d="$mh=".concat(e)}var p=s+"?".concat(l).concat(h).concat(u).concat(d);return this.htmlShareLink.attr("href",p),p}},{key:"getChartData",value:function(t){var e=$j(t),a=e.attr("nbhcodes");this.chartCommunities=Object.values(JSON.parse(e.attr("nbhnames"))),this.chartType=e.attr("name"),this.canvasImage&&(this.canvasImage.marketSection=t);var r=JSON.stringify(this.Years),n=this.Month;console.log(a);var i=this,c="";switch(i.ChartTypeSelect.value){case"dollar":c=(pid_Data.siteurl.indexOf("pidhomes.ca"),pid_Data.siteurl+"/wp-content/themes/realhomes-child-3/db/chartData.php");break;case"percentage":c=(pid_Data.siteurl.indexOf("pidhomes.ca"),pid_Data.siteurl+"/wp-content/themes/realhomes-child-3/db/chartData_Percentage.php")}$j.ajax({url:c,method:"get",data:{Neighborhood_IDs:a,Years:r,Month:n},dataType:"JSON",success:function(t){t.forEach((function(t){var e=t.property_Type.trim(),a={label:i.neighborhoodNames[t.nbr_ID.trim()],data:t.nbr_Data},r=i.neighborhoodNames[t.nbr_ID.trim()],n={label:i.neighborhoodNames[t.nbr_ID.trim()]+"_"+e,data:t.nbr_Data};switch(i.chartDataSets_GroupByNbh.push([r,n]),e){case"All":i.chartDataSets_All.push(a);break;case"Detached":i.chartDataSets_Detached.push(a);break;case"Townhouse":i.chartDataSets_Townhouse.push(a);break;case"Apartment":i.chartDataSets_Apartment.push(a)}}));var e=i.PropertyTypeSelect;if(Array.from(i.PropertyTypeSelect).filter((function(t){return"on"==t.value}))[0].checked){var a=i.nbhLabel?i.nbhLabel:i.chartDataSets_GroupByNbh[0][0],r=i.chartDataSets_GroupByNbh.filter((function(t){return t[0]==a})).map((function(t){return t[1]}));i.configChart(r,i.chartColors2)}else for(var n=0;n<e.length;n++){var c=e[n].value;if(e[n].checked){switch(c){case"All":i.configChart(i.chartDataSets_All,i.chartColors2);break;case"Detached":i.configChart(i.chartDataSets_Detached,i.chartColors2);break;case"Townhouse":i.configChart(i.chartDataSets_Townhouse,i.chartColors2);break;case"Apartment":i.configChart(i.chartDataSets_Apartment,i.chartColors2)}break}}i.prepareCanvasSize(i.chartConfig.data.datasets.length),i.drawChart(i.chartConfig)}})}},{key:"getChartData_Compare",value:function(t){this.canvasImage&&(this.canvasImage.marketSection=t);for(var e=$j(t).find('input[type="hidden"]'),a=$j(t).find("label"),r="",n={},i=0;i<e.length;i++){if("yes"==$j(a[i]).attr("showchart")){var c=$j(e[i]).attr("nbhcodes"),o=JSON.parse($j(e[i]).attr("nbhnames"));r=r+" "+c,n[c]=o[c]}}r=r.trim().split(" ").join(", "),console.log("".concat(r," & ").concat(n));var s=JSON.stringify(this.Years),l=this.Month;console.log(r);var h=this,u="";switch(h.ChartTypeSelect.value){case"dollar":u=(pid_Data.siteurl.indexOf("pidhomes.ca"),pid_Data.siteurl+"/wp-content/themes/realhomes-child-3/db/chartData.php");break;case"percentage":u=(pid_Data.siteurl.indexOf("pidhomes.ca"),pid_Data.siteurl+"/wp-content/themes/realhomes-child-3/db/chartData_Percentage.php")}$j.ajax({url:u,method:"get",data:{Neighborhood_IDs:r,Years:s,Month:l},dataType:"JSON",success:function(t){t.forEach((function(t){var e=t.property_Type.trim(),a={label:n[t.nbr_ID.trim()],data:t.nbr_Data},r=h.neighborhoodNames[t.nbr_ID.trim()],i={label:h.neighborhoodNames[t.nbr_ID.trim()]+"_"+e,data:t.nbr_Data};switch(h.chartDataSets_GroupByNbh.push([r,i]),e){case"All":h.chartDataSets_All.push(a);break;case"Detached":h.chartDataSets_Detached.push(a);break;case"Townhouse":h.chartDataSets_Townhouse.push(a);break;case"Apartment":h.chartDataSets_Apartment.push(a)}}));var e=h.PropertyTypeSelect;if(Array.from(h.PropertyTypeSelect).filter((function(t){return"on"==t.value}))[0].checked){var a=h.chartDataSets_GroupByNbh.map((function(t){return t[1]}));h.configChart(a,h.chartColors2)}else for(var r=0;r<e.length;r++){var i=e[r].value;if(e[r].checked){switch(i){case"All":h.configChart(h.chartDataSets_All,h.chartColors2);break;case"Detached":h.configChart(h.chartDataSets_Detached,h.chartColors2);break;case"Townhouse":h.configChart(h.chartDataSets_Townhouse,h.chartColors2);break;case"Apartment":h.configChart(h.chartDataSets_Apartment,h.chartColors2)}break}}h.prepareCanvasSize(h.chartConfig.data.datasets.length),h.drawChart(h.chartConfig)}})}},{key:"drawChart",value:function(t){console.log(t);var e=Chart.Legend.prototype.afterFit;Chart.Legend.prototype.afterFit=function(){if(e.call(this),this.options&&this.options.maxSize){var t=this.options.maxSize;void 0!==t.height&&(this.height=Math.min(this.height,t.height),this.minSize.height=Math.min(this.minSize.height,this.height)),void 0!==t.width&&(this.width=Math.min(this.width,t.width),this.minSize.width=Math.min(this.minSize.width,this.width))}},Chart.defaults.global.defaultFontFamily="Montserrat",Chart.defaults.global.elements.line.fill=!1,this.pidChart=new Chart(this.ctx,t),this.chartCanvas.hidden=!1,$j("#".concat(this.chartCanvasID)).length>0&&(null==this.canvasImage?this.canvasImage=new o(this.chartCanvasID,this.marketSection):this.canvasImage.socialShare.config=JSON.parse(JSON.stringify(this.canvasImage.socialDefaultConfig))),this.drawCanvas=document.getElementById(this.chartCanvasID)}}]),t}();function h(t,e){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(t,e)}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,o=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return c=t.done,t},e:function(t){o=!0,i=t},f:function(){try{c||null==a.return||a.return()}finally{if(o)throw i}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}var d=function(){function t(e,a){n()(this,t),this.table=e,this.cmaType=a,this.tableID=$j(e).attr("data-wpdatatable_id");var r=!1;"none"==$j("#pid-mobile").css("display")&&(r=!0),this.is_mobile=r;var i=window.location.pathname.split("/"),c=i.pop();switch(""==c&&(c=i.pop()),"cn"!=c&&this.events(),this.cmaType){case"active":this.evaluateButton1(),this.evaluateButton2(),this.startOver();break;case"sold":this.evaluateSoldButton1(),this.evaluateSoldButton2(),this.startOverSold()}}return c()(t,[{key:"events",value:function(){var t=this;new MutationObserver((function(e,a){var r,n=h(e);try{for(n.s();!(r=n.n()).done;){if("childList"===r.value.type){a.disconnect(),setTimeout((function(){t.get_aggregates(),t.table_events(),setTimeout((function(){t.evaluateByMarketPrice("active"),t.evaluateByBCAChange("active"),t.evaluateByMarketPrice("sold"),t.evaluateByBCAChange("sold")}),2e3)}),5e3);break}}}catch(t){n.e(t)}finally{n.f()}})).observe(this.table,{attributes:!1,childList:!0,subtree:!0})}},{key:"table_events",value:function(){this.table.querySelectorAll("tr").forEach((function(t){return t.addEventListener("click",(function(t){$j(t.target.parentNode).toggleClass("pid_clicked_table_row")}))}))}},{key:"get_aggregates",value:function(){var t=4,e=9,a=10;switch(this.tableID){case"34":4,6,t=5,this.setSummaryCMACell(34,"max",4,this.cmaType),this.setSummaryCMACell(34,"min",4,this.cmaType),this.setSummaryCMACell(34,"avg",4,this.cmaType),this.setSummaryCMACell(34,"max",6,this.cmaType),this.setSummaryCMACell(34,"min",6,this.cmaType),this.setSummaryCMACell(34,"avg",6,this.cmaType),this.setSummaryCMACell(34,"max",5,this.cmaType),this.setSummaryCMACell(34,"min",5,this.cmaType),this.setSummaryCMACell(34,"avg",5,this.cmaType);break;case"35":t=this.is_mobile?3:4,e=this.is_mobile?7:11,a=this.is_mobile?8:12,this.setSummaryCMACell(35,"max",t,this.cmaType),this.setSummaryCMACell(35,"min",t,this.cmaType),this.setSummaryCMACell(35,"avg",t,this.cmaType),this.setSummaryCMACell(35,"max",e,this.cmaType),this.setSummaryCMACell(35,"min",e,this.cmaType),this.setSummaryCMACell(35,"avg",e,this.cmaType),this.setSummaryCMACell(35,"max",a,this.cmaType),this.setSummaryCMACell(35,"min",a,this.cmaType),this.setSummaryCMACell(35,"avg",a,this.cmaType)}var r=$j('td[data-column_header="City_Name_CN"]');r.length>0&&r.addClass("pid_wpdatatable_hidden_column")}},{key:"evaluateButton1",value:function(){var t=this;$j("#pid_cma_evaluate_submit").click((function(e){t.evaluateByMarketPrice("active")}))}},{key:"evaluateByMarketPrice",value:function(t){var e=34==this.tableID?"#pid_cma_".concat(t,"_price_per_square_feet_max"):"#pid_cma_".concat(t,"_land_price_per_square_feet_max"),a=34==this.tableID?"#pid_cma_".concat(t,"_price_per_square_feet_avg"):"#pid_cma_".concat(t,"_land_price_per_square_feet_avg"),r=34==this.tableID?"#pid_cma_".concat(t,"_price_per_square_feet_min"):"#pid_cma_".concat(t,"_land_price_per_square_feet_min"),n=34==this.tableID?"#pid_cma_".concat(t,"_price_per_square_feet_max"):"#pid_cma_".concat(t,"_improve_price_per_square_feet_max"),i=34==this.tableID?"#pid_cma_".concat(t,"_price_per_square_feet_avg"):"#pid_cma_".concat(t,"_improve_price_per_square_feet_avg"),c=34==this.tableID?"#pid_cma_".concat(t,"_price_per_square_feet_min"):"#pid_cma_".concat(t,"_improve_price_per_square_feet_min"),o=34==this.tableID?"":"#pid_cma_".concat(t,"_bca_change_perc_avg"),s=0,l=0,h=0,u=parseFloat($j(e).text().trim().replace("$","").replace(",","").replace("%","")),d=parseFloat($j(a).text().trim().replace("$","").replace(",","").replace("%","")),p=parseFloat($j(r).text().trim().replace("$","").replace(",","").replace("%","")),m=parseFloat($j(n).text().trim().replace("$","").replace(",","").replace("%","")),_=parseFloat($j(i).text().trim().replace("$","").replace(",","").replace("%","")),g=parseFloat($j(c).text().trim().replace("$","").replace(",","").replace("%","")),v=parseFloat($j("#pid_cma_total_floor_area").text().trim().replace(",","")),f=parseFloat($j("#pid_cma_total_land_size").text().trim().replace(",","")),b=parseFloat($j("#pid_cma_bca_total_value").text().trim().replace(",","").replace("$","")),C=parseFloat($j(o).text().trim().replace(",","").replace("%",""));switch(this.tableID){case"34":s=u*v,l=d*v,h=p*v;break;case"35":s=u*f*(100+C)/100,l=d*f*(100+C)/100,h=p*f*(100+C)/100,s+=m*v*(100+C)/100,l+=_*v*(100+C)/100,h+=g*v*(100+C)/100}var y=$j("#pid_market_".concat(t,"_value_max")),k=$j("#pid_market_".concat(t,"_value_avg")),S=$j("#pid_market_".concat(t,"_value_min")),w=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0});S.text("------"),k.text("------"),y.text(w.format(s.toFixed(0))),b<1.1*l&&k.text(w.format(l.toFixed(0))),b<h&&S.text(w.format(h.toFixed(0)));var D=s-h,j=s-parseInt($j("#subject-".concat(t,"-price-id")).attr("value")),$=s-l,x="active"==t?1:3;this.drawValuePriceRationGauge(0,$,D,j,x)}},{key:"evaluateSoldButton1",value:function(){var t=this;$j("#pid_cma_sold_evaluate_submit").click((function(e){t.evaluateByMarketPrice("sold")}))}},{key:"evaluateButton2",value:function(){var t=this;$j("#pid_cma_evaluate_by_bca_submit").click((function(e){t.evaluateByBCAChange("active")}))}},{key:"evaluateByBCAChange",value:function(t){var e="#pid_cma_".concat(t,"_bca_change_perc_max"),a="#pid_cma_".concat(t,"_bca_change_perc_avg"),r="#pid_cma_".concat(t,"_bca_change_perc_min"),n="#pid_market_".concat(t,"_value_max_2"),i="#pid_market_".concat(t,"_value_avg_2"),c="#pid_market_".concat(t,"_value_min_2"),o=parseFloat($j("#pid_cma_bca_total_value").text().trim().replace(/,/g,"").replace("$","")),s=(100+parseFloat($j(e).text().trim().replace("$","").replace(/,/g,"").replace("%","")))/100*o,l=(100+parseFloat($j(a).text().trim().replace("$","").replace(/,/g,"").replace("%","")))/100*o,h=(100+parseFloat($j(r).text().trim().replace("$","").replace(/,/g,"").replace("%","")))/100*o,u=$j(n),d=$j(i),p=$j(c),m=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0});u.text(m.format(s.toFixed(0))),d.text(m.format(l.toFixed(0))),p.text(m.format(h.toFixed(0)));var _=s-h,g=s-parseInt($j("#subject-".concat(t,"-price-id")).attr("value")),v=s-l,f="active"==t?2:4;this.drawValuePriceRationGauge(0,v,_,g,f)}},{key:"evaluateSoldButton2",value:function(){var t=this;$j("#pid_cma_sold_evaluate_by_bca_submit").click((function(e){t.evaluateByBCAChange("sold")}))}},{key:"startOver",value:function(){var t=this;$j("#pid_cma_evaluate_start_over").click((function(e){t.resetCMAResult("active"),resetGauge(1),resetGauge(2)}))}},{key:"startOverSold",value:function(){var t=this;$j("#pid_cma_sold_evaluate_start_over").click((function(e){t.resetCMAResult("sold"),resetGauge(3),resetGauge(4)}))}},{key:"resetCMAResult",value:function(t){var e=$j("#pid_market_".concat(t,"_value_max")),a=$j("#pid_market_".concat(t,"_value_avg")),r=$j("#pid_market_".concat(t,"_value_min"));e.text("$"),a.text("$"),r.text("$");var n=$j("#pid_market_".concat(t,"_value_max_2")),i=$j("#pid_market_".concat(t,"_value_avg_2")),c=$j("#pid_market_".concat(t,"_value_min_2"));n.text("$"),i.text("$"),c.text("$")}},{key:"drawValuePriceRationGauge",value:function(t,e,a,r,n){var i="#6FADCF",c={angle:.15,lineWidth:.36,radiusScale:1,pointer:{length:.6,strokeWidth:.035,color:"#000000"},limitMax:!1,limitMin:!1,colorStart:i=r>e?"#00FF55":"#FF2A2A",colorStop:i,strokeColor:"#E0E0E0",generateGradient:!0,highDpiSupport:!0},o=document.getElementById("cma-value-price-ratio-gauge-".concat(n)),s=o.getContext("2d"),l=o.width,h=o.height;s.clearRect(0,0,l,h);var u=new Gauge(o).setOptions(c);u.maxValue=a,u.setMinValue(0),u.animationSpeed=32,u.set(r)}},{key:"setSummaryCMACell",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:34,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"max",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"active",n=this.is_mobile?3:4,i=this.is_mobile?7:11,c=this.is_mobile?8:12,o=$j("#pid_cma_".concat(r,"_listings")),s=o.next().find("table[data-wpdatatable_id=".concat(t,"]"));if(s.length>0){var l=s[0],h=$j(l).find("td.wdt-".concat(e,"-cell"))[a];if(h&&0!==h){var u=h.innerText.toLowerCase().replace("".concat(e),"").replace("最大值:","").replace("最小值:","").replace("平均值:","").replace("=","").replace(".00","").replace(",","").trim();u=(u=parseFloat(u))>1e3?u.toFixed(0):u.toFixed(1);var d="";switch(t){case 34:switch(a){case 4:d="pid_cma_".concat(r,"_price");break;case 5:d="pid_cma_".concat(r,"_bca_change_perc");break;case 6:d="pid_cma_".concat(r,"_price_per_square_feet")}break;case 35:switch(a){case n:d="pid_cma_".concat(r,"_bca_change_perc");break;case i:d="pid_cma_".concat(r,"_land_price_per_square_feet");break;case c:d="pid_cma_".concat(r,"_improve_price_per_square_feet")}}var p=$j("#".concat(d,"_").concat(e.toLowerCase()));switch(t){case 34:5==a?p.text(u+"%"):p.text("$"+parseFloat(u).toLocaleString());break;case 35:a==n?p.text(u+"%"):p.text("$"+parseFloat(u).toLocaleString())}}}}},{key:"hiddenColumn",value:function(){this.htmlCityNameCN.addClass("pid_wpdatatable_hidden_column")}}]),t}();function p(t,e){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function(t,e){if(!t)return;if("string"==typeof t)return m(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return m(t,e)}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,o=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return c=t.done,t},e:function(t){o=!0,i=t},f:function(){try{c||null==a.return||a.return()}finally{if(o)throw i}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}$j(document).ready((function(){if($j("#lineChart").length,$j("#line_chart_1").length>0)new l("line_chart_1");if($j("#line_chart_2").length>0)new l("line_chart_2");if($j("#line_chart_3").length>0)new l("line_chart_3");var t,e=[],a="",r=p(document.getElementsByClassName("pid_cma_listing_tables"));try{for(r.s();!(t=r.n()).done;){var n=t.value;switch(n.id){case"pid_cma_active_listings":a="active";break;case"pid_cma_sold_listings":a="sold"}var i=$j(n.nextElementSibling).find("table");if(i.length>0){var c=i[0];e.push(new d(c,a))}}}catch(t){r.e(t)}finally{r.f()}resetGauge(1),resetGauge(2),resetGauge(3),resetGauge(4)}))}]);